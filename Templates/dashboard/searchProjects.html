{% extends 'partials/dashboard_layout.html' %}
{% block 'mainlayout' %}

<section id="basic-datatable">




	<div class="row">
		<div class="col-12">
			<div class="card" style="padding:0px 2%">
				<div class="card-header border-bottom p-1">
					<div class="head-label">
						<h6 class="mb-0">Files Listing</h6>
					</div>


					
					<div class="dt-action-buttons text-end"> 
						<div class="dt-buttons d-inline-flex">
							<a type="button" class="btn btn-info" id="clear_filter_btn">
								Clear Filter
							</a>
						</div> 



                        <!-- <button id="delete_files_btn" type="button" class="btn btn-danger waves-effect">
                            <i class="me-50" data-feather="trash"></i>
                            <span>Delete Files</span>
                        </button> -->


                        <!-- 
                        <button type="button" class="btn btn-success waves-effect" id="show_all_users_modal_btn" data-bs-toggle="modal" data-bs-target="#show_all_users_modal">
                            <i class="me-50" data-feather="share-2"></i>
                            Share
                        </button> -->

                        <a href="{%url 'addNewProject'%}" type="button" class="btn btn-primary waves-effect">
                            <i class="me-50" data-feather="plus"></i>
                            <span>Post New Porject</span>
                        </a>
                



					</div>
				</div>


				<div class="row" id="basic-table">
					<div class="col-12">

						{% for project in available_projects %}
							<div class="card">
								<div class="card-body" style="background-color: rgb(246, 251, 255);">
									<div class="d-flex justify-content-between">
										<h3>{{project.title}}</h3>
										<span>
											<a class="btn btn-primary"  href="{%url 'viewProject'%}?id={{project.id}}">Submit Proposal</a>
											<a class="btn btn-primary"  href="{%url 'viewProjectBids'%}?id={{project.id}}">View Bids</a>
										</span>
									</div>
									<span>{{project.description}}</span>
								<span><br>
									<b>Budget: </b>{{project.budget}}<br>
									<b>Timeline: </b>{{project.start_date}} - {{project.end_date}} <br>
									<b>Skills:</b>
									{% for skill in project.skills.all %}
										<span class="badge bg-success">{{skill}}</span>
									{% endfor %}

								</span>
								
								
								</div>
							</div>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

 
<script>
	populateTableCheckBoxes('projects_table_checkbox_parent', 'projects_table_checkbox_child')
	var available_projects = JSON.parse(`{{json_available_projects |safe}}`);
	var target_rows = $(".project_tr")


    $(".delete_project_btn").click(function (e) {
        if(!confirm("Are you sure you want to delete this project ?")){
            e.preventDefault();
            return ;
        }
    })
  
	$('.filter_input_query').on('keyup change', function (e) {
		var file_name = $('#file_name').val().replace("  ", '').toLowerCase()
		var uuid = $('#uuid').val().replace("  ", '').toLowerCase()
		var upload_date = $('#upload_date').val().replace("  ", '').toLowerCase() 

		for (var i = 0; i < target_rows.length; i++) {
			var current_record_id = $(target_rows[i]).prop('id')
			var current_record = available_projects[i] 
      
			if (
				current_record.orignal_file_name.toLowerCase().includes(file_name) &&
				current_record.file_name.toLowerCase().includes(uuid) && 
				current_record.timestamp.toLowerCase().includes(upload_date)   
			) {
				$(target_rows[i]).show()
			} else {
				$(target_rows[i]).hide()
			}
		}
	})

	$("#clear_filter_btn").click(function (e) {
		$('#file_name').val('')
		$('#uuid').val('')
		$('#upload_date').val('') 
		for (var i = 0; i < target_rows.length; i++) {
			$(target_rows[i]).show()
		}
	})




	$("#delete_files_btn").click(function () {
		var ids = getSelectedChildIds('projects_table_checkbox_child')
		console.log(ids)
		if (ids.length < 1) {
			alert("Please select atleast one File")
			return
		}
		var decision = confirm("Are you sure to delete selected Files ?")
		if (!decision) {
			e.preventDefault()
			return
		} 
		$.ajax({
			url: `{%url 'manageProjects'%}?ids=${ids}`,
			dataType: 'json',
			success: function (res) {
				window.location.reload()
			}
		})
	})
</script>
{% endblock 'mainlayout' %}